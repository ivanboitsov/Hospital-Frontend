<h1>Описание лабораторной работы №3</h1>
<h3>Введение</h3>
В данном задании необходимо реализовать медицинскую информационную систему.

<h3>Требования, макеты и функционал</h3>

Документация API - https://mis-api.kreosoft.space/swagger/index.html

**Диаграмма классов предметной области**

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/a7b11b58-6285-4231-bdee-7c9b40fe27f2)


Поскольку множество функционала сайта завязано на пользователе, необходимо предусмотреть возможность регистрации пользователей и их дальнейшей авторизации. В системе предусмотрена регистрация и авторизация только для пользователей, являющихся врачами.

<h3>Авторизация</h3>

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/1b9051e0-032e-4863-a66e-41d54f82f354)

Адрес, который должен быть у вас в адресной строке при открытии страницы авторизации: http://localhost/login/

По данному адресу нужно отправить POST запрос с необходимыми данными. В ответ будет отправлен TOKEN авторизации зарегистрированного пользователя (если авторизация прошла успешно).

Для авторизации нужно использовать email как логин.

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/551922a7-0d58-4b00-b848-f89c8d51464e)

**Обратите внимание**: после успешной авторизации в навбаре справа кнопка “Вход” меняется на кнопку с ФИО пользователя, при нажатии на которую вываливается список с кнопками “Профиль” и “Выход”

**Обратите внимание!** Если имя пользователя слишком длинное, оно отображается не полностью.

<h3>Регистрация</h3>

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/4419b54d-f075-4bea-a52b-1282a45829ad)

Адрес, который должен быть у вас в адресной строке при открытии страницы регистрации: http://localhost/registration/

По данному адресу нужно отправить POST запрос с необходимыми данными. В ответ будет отправлен TOKEN авторизации зарегистрированного пользователя (если регистрация прошла успешно).

**Обратите внимание**, на страницах, где пользователь вводит номер телефона должна присутствовать валидация по следующей маске +7 (xxx) xxx-xx-xx.

<h3>Профиль</h3>

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/3e2a41d6-9e4f-4a67-8c5e-38fa6dc38e73)

Страница должна быть доступна по ссылке http://localhost/profile

Редактировать можно email, ФИО, номер телефона, пол и дату рождения

<h3>Список пациентов</h3>

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/b8cab9f2-0696-4c0c-b9c8-de42c68d9d90)

На данной странице отображается список всех пациентов, зарегистрированных в системе. 
На больших экранах пациентов необходимо выводить в 2 колонки, при небольшом экране следует отображать данные в одну колонку.

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/7a1521ab-a143-4160-aa7d-f45223580852)

Поскольку на сайте присутствует пагинация, нужно предусмотреть механизм, который не просто отправляет запрос на сервер с номером страницы и количеством элементов на ней и обновляет список пациентов, нужно сделать так, чтобы при изменении страницы, номер и размер отображался в URL и при перезагрузке страницы отображался корректный список постов для последней выбранной страницы. 

Как должен выглядеть URL при пагинации по блогу:

  * localhost/patients - первая страница, количество отображаемых пациентов 5 (по умолчанию)
  * localhost/patients/?page=1&pageSize=5 - также первая страница
  * localhost/patients/?page=N&pageSizeM - страница N, количество постов M

Чтобы реализовать подобный механизм, элементы пагинации должны быть не просто кнопками с обработчиками событий, а полноценными элементами навигации.

На сайте присутствует механизм фильтрации и сортировки пациентов по нескольким критериям, которые могут быть скомбинированы между собой:

* поиск по имени пациента;
* фильтрация по имеющимся заключениям осмотров (есть хотя бы один осмотр с данным заключением): Выздоровление, Болезнь, Смерть;
* фильтрация по критерию “Есть запланированные визиты” (показывать только пациентов, у которых запланированы дальнейшие осмотры);
* фильтрация по критерию “Мои пациенты” (показывать пациентов, у которых есть хотя бы 1 осмотр, сделанный данным врачом);
* сортировка пациентов (по имени пациента (от А-Я, от Я-А), по дате создания (сначала новые, сначала старые), по дате осмотров (сначала новые осмотры, сначала старые осмотры)).

Примеры URL при пагинации и фильтрации:
* localhost/patients/?page=1 - также первая страница
* localhost/patients/?page=N - страница N
* localhost/patients?name=Василий&conclusions=Disease&sorting=InspectionAsc&page=1&size=5 
* localhost/patients/?sorting=CreateDesc
* localhost/patients/?onlyMine=true
  
По желанию вы можете изменить отображение блока фильтрации и сортировки при помощи использования библиотек.

При нажатии на кнопку “Регистрация нового пациента” открывается модальное окно с возможностью зарегистрировать нового пациента. Для регистрации необходимо указать его ФИО, пол и дату рождения.  

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/562fb1f6-0d35-4832-9af2-fe41a8b44019)

При нажатии на карточку пациента  открывается страница “Карта пациента”.

<h3>Карта пациента</h3>

Страница должна быть доступна по ссылке http://localhost/patient/{id}.

Данную страницу можно условно разделить на две части: данные пациента и список его осмотров. 

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/ad84c970-6ff7-4546-bacd-ae3efd6dc933)

**Обратите внимание!** 
* При большом размере экрана осмотры пациента отображаются в 2 колонки, при небольшом размере экрана контент показывается без разделения на колонки.

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/de580ce9-0c86-47b8-916a-0185da16269c)

* Иконки пациентов отличаются в зависимости от пола (Мужской, Женский)
* Осмотр с заключением “Смерть” выделяется цветом, пациент не может иметь дальнейших осмотров. 

На данной странице доступна пагинация осмотров, а также предусмотрен механизм фильтрации по следующим критериям, которые могут быть скомбинированы между собой:
* фильтрация по корневым кодам МКБ-10 -  отображаются только те осмотры, основной диагноз которых входит в данную группу МКБ-10;
* фильтрация по критерию “Сгруппировать по повторным” - при выборе данного критерия осмотры группируются в цепочки взаимосвязанных осмотров.

При выборе фильтра “Сгруппировать по повторным” у осмотров, имеющих цепочку появляется дополнительный UI-элемент, по нажатию на который будет показан следующий в цепочке осмотр. Обратите внимание, следующий в цепочке осмотр  имеет отступ от предыдущего (после 3 осмотра, осмотры можно выводить друг под другом).

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/f800ead6-8a9e-45a7-a544-d16dd85e904b)

При нажатии на кнопку “Добавить осмотр” открывается страница “Создания осмотра”.

**Обратите внимание**: на странице присутствует 2 вида кнопок “Добавить осмотр”:
* расположена вверху страницы

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/ac20053b-88c6-4e27-96cf-893a8fc6199f)

* расположен на карточке осмотра 
    * отображается на карточке осмотра только в том случае, если у осмотра еще нет дочерних осмотров (атрибут hasNested имеет значение false);
    * при нажатии - новый осмотр должен быть отмечен, как “Повторный осмотр”, а данный осмотр должен быть выбран, как предыдущий для создаваемого

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/fdb5e30b-9810-4fdc-b8d9-40b3383644cc)

При нажатии на кнопку “Детали осмотра” открывается страница “Детали осмотра”. 

<h3>Создание осмотра</h3>

Страница создания осмотра- localhost/inspection/create

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/4ccc99c8-14d1-4d94-a5d7-6750a2d587e1)

**Особенности создания осмотра:**
* запрещено создавать осмотры в будущем (дата создания осмотра не должна быть больше текущего времени), осмотр не может быть сделан ранее предыдущего осмотра в цепочке;
* осмотр обязательно должен иметь один диагноз с типом диагноза “Основной”;
* при выборе заключения “Болезнь”, необходимо указать дату и время следующего визита, при выборе заключения “Смерть”, необходимо указать дату и время смерти, при заключении “Выздоровление” эти данные вносить не требуется;

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/0ee9afc1-0d60-45e5-9624-0803e251d560)

* у пациента не может быть более одного осмотра с заключением “Смерть”;
* осмотр не может иметь несколько консультаций с одинаковой специальностью врача;
* при создании консультации врач-автор осмотра должен указать комментарий, описывающий проблему.

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/65000f61-e8b6-45dd-977a-8424572dfbb8)

В select-поле Предыдущий осмотр” необходимо вывести дату осмотра и основной диагноз (см. /api/patient/{id}/inspections/search). 
Пример: **26.12.2023 10:00 J20 - Острый бронхит**.

<h3>Детали осмотра</h3>

Страница  должна быть доступна по ссылке - localhost/inspection/{id}

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/a173a353-aa39-4905-93cd-2d24fb140a6c)

При нажатии на кнопку редактирования осмотра должно быть открыто модальное окно, предоставляющее возможность отредактировать основные поля осмотра: жалобы, анамнез, рекомендации по лечению, заключение, диагнозы. Редактирование осмотра доступно только врачу, создавшему данный осмотр. Основные правила для валидации осмотра остаются аналогичны правилам создания осмотра.   

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/799c6443-0c38-4312-9ddd-9905124b5b72)

**Обратите внимание на блоки консультации:**
* Изначально  карточка консультации содержит только информацию о требуемом специалисте,комментарий врача-автора осмотра и количество ответов врачей-специалистов. Если консультация имеет вложенные комментарии-ответы, то при нажатии на карточку должны быть показаны сообщения-ответы.
* Возле комментариев, написанных пользователем, должны быть кнопки редактирования. При нажатии на кнопку изменения комментария, его текст должен замениться формой для редактирования текста этого комментария.
* При нажатии на кнопку “Ответить” под комментарием должна появляться форма для написания ответа. Кнопка “Ответить” должна быть доступна врачу-автору осмотра и врачам, имеющим требуемую для консультации специальность.
* Если комментарий был ранее изменен, то после его текста должна присутствовать пометка об этом. При наведении на эту пометку, должны отображаться дата и время последнего изменения.

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/c9f5a5c9-535d-493f-a9b7-f78c16bd3e10)

<h3>Список консультаций</h3>

Страница  должна быть доступна по ссылке - localhost/consultations

На данной странице отображаются осмотры, содержащие консультации, соответствующие специальности пользователя.

На больших экранах осмотры стоит выводить в 2 колонки, при небольшом экране следует отображать данные в одну колонку.

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/5dc0243a-5245-4c46-ac15-4726de359fe8)

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/bcd0a27a-df8b-40db-a861-88a4ac8e32cb)

В системе предусмотрена пагинация осмотров, а также имеется механизм фильтрации по следующим критериям, которые могут быть скомбинированы между собой:
* фильтрация по корневым кодам МКБ-10 -  отображаются только те осмотры, основной диагноз который входит в данную группу МКБ-10;
* фильтрация по критерию “Сгруппировать по повторным” - при выборе данного критерия осмотры группируются в цепочки взаимосвязанных осмотров.

По нажатию на карточку осмотра открывается страница “Детали осмотра”.
<h3>Генерация отчёта</h3>

Страница  должна быть доступна по ссылке - localhost/reports

На данной странице содержится форма для генерации отчета - статистики осмотров.
В фильтрах отчета задается диапазон дат для построения отчета и выбираются корневые элементы справочника МКБ-10. Если корневые элементы не были выбраны, то отчет строится без фильтрации по корням справочника МКБ-10 (то есть, по всем осмотрам в системе, попадающим в заданный диапазон дат).

![image](https://github.com/ivanboitsov/Hospital-Frontend/assets/118753603/1e5fb9bc-519e-46a3-b58d-7db930ecdf5e)

После получения данных отчета от backend, необходимо вывести его в виде таблицы на данной странице под формой с выбранными параметрами фильтрации (**дизайн таблицы необходимо разработать самостоятельно - это тоже часть задания**).

Каждая колонка отчета - это корень МКБ-10.

Каждая строка отчета представляет статистику посещений пациента за выбранный период.

Учитывая вышесказанное, в ячейке отчета содержится количество посещений пациента, связанных с болезнью из поддерева корня МКБ-10, за выбранный период.

Ответ от сервера содержит выбранные фильтры для формирования отчета, строки отчета, **отсортированные по имени пациента** и итог всего отчета с разбивкой по корням МКБ-10. **Корни в объекте фильтров и в объекте итогов должны быть отсортированы по коду МКБ-10.** Детальнее смотрите документацию и ответы сервера в swagger /api/report/icdrootsreport

<h3>Справочник МКБ-10</h3>

Для работы с диагнозами пациентов и осмотрами в данной системе необходимо использовать справочник МКБ-10. Актуальные данные справочника можно получить по данной ссылке:
https://nsi.rosminzdrav.ru/dictionaries/1.2.643.5.1.13.13.11.1005/passport/latest

Также по ссылке доступно скачивание справочника в разных форматах, что вы можете использовать для импорта.

В системе должен быть предусмотрен эндпоинт для поиска по справочнику. В качестве поискового запроса передается строка, которая может содержать, как полный код записи из справочника, так и по названию диагноза.
